# Microservice-lar (2-qism)

Oldingi qismda Admin microserviceni uchun Dockerda Laravel proyektini ko'tarib, unda Productlar uchun oddiy CRUD yozgan edik. Endi, bu qismda Main microserviceni ko'tarishni ko'ramiz.

1. Laravel proyektini o'rnatib olamiz: `composer create-project laravel/laravel main`
2. Admin microserviceda yozgan `Dockerfile` va `docker-compose.yml` fayllarini proyektimizning root papkasiga nusxalab olamiz (chunki backend qismlari bir xil bo'lyapti):

`Dockerfile`:

```apache
FROM  php:8.1-fpm

RUN apt-get update && apt-get install -y \
	libfreetype6-dev \
	libjpeg62-turbo-dev \
	libmcrypt-dev \
	libpng-dev \
	zlib1g-dev \
	libxml2-dev \
	libzip-dev \
	libonig-dev \
	graphviz \
     && docker-php-ext-configure gd \
     && docker-php-ext-install -j$(nproc) gd \
     && docker-php-ext-install pdo_mysql \
     && docker-php-ext-install mysqli \
     && docker-php-ext-install zip \
     && docker-php-ext-install sockets \
     && docker-php-source delete

RUN curl -sS https://getcomposer.org/installer | php -- \
      --install-dir=/usr/local/bin --filename=composer

WORKDIR /app
COPY . .
RUN composer install
CMD php artisan serve --host=0.0.0.0
EXPOSE 8000

```

Bu yerda hech narsani o'zgartirmaymiz.

`docker-compose.yml`:

```apache
version: '3.8'
services:
  main: # <== o'zgardi
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app
    ports:
      - 8001:8000 # <== o'zgardi
    depends_on:
      - main_db # <== o'zgardi

  main_db: # <== o'zgardi
    image: mysql:5.7.22
    environment:
      MYSQL_DATABASE: main # <== o'zgardi
      MYSQL_PASSWORD: root
      MYSQL_ROOT_PASSWORD: root
    volumes:
      - ./storage/dbdata:/var/lib/mysql
    ports:
      - 33062:3306 # <== o'zgardi

```

Bu yerda faqat containerlarning nomlari va chiquvchi portlar o'zgardi (docker containerning ichidagi portlarini o'zgartirish shart emas).

3. `.env` faylda database sozlamalarini to'g'rilaymiz:

```apache
# ...
DB_CONNECTION=mysql
DB_HOST=main_db
DB_PORT=3306
DB_DATABASE=main
DB_USERNAME=root
DB_PASSWORD=root
#...
```

4. Dockerni ishga tushiramiz: `docker-compose up`
